<html lang="en" class="responsive">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="favicon.ico">
  <title>Surveys</title>
  <link href="https://studenthealthoc.sa.ucsb.edu/Resources/yui/build/yui-combined.css" rel="stylesheet"><!-- YUICSS -->
  <link href="https://studenthealthoc.sa.ucsb.edu/Resources/stylesheets/themes/bootstrap.cerulean.min.css"
    rel="stylesheet"><!-- THEME -->
  <link href="https://studenthealthoc.sa.ucsb.edu/Resources/stylesheets/plugins/toastr/toastr.min.css" rel="stylesheet">
  <link href="https://studenthealthoc.sa.ucsb.edu/Resources/stylesheets/ie10-viewport-bug-workaround.css"
    rel="stylesheet">
  <link href="https://studenthealthoc.sa.ucsb.edu/bower_components/bootstrap-sidebar/dist/css/sidebar.css"
    rel="stylesheet">
  <link href="https://studenthealthoc.sa.ucsb.edu/bower_components/font-awesome/css/font-awesome.min.css"
    rel="stylesheet" type="text/css">
  <link href="https://studenthealthoc.sa.ucsb.edu/Resources/stylesheets/plugins/bootstrap-datepicker3.min.css"
    rel="stylesheet">
  <link href="https://studenthealthoc.sa.ucsb.edu/Resources/lib/datetimepicker/datetimepicker.css" rel="stylesheet">
  <link href="https://studenthealthoc.sa.ucsb.edu/Resources/stylesheets/responsive.css" rel="stylesheet">
  <link href="https://studenthealthoc.sa.ucsb.edu/Resources/stylesheets/upload.css" rel="stylesheet">
  <!-- <script src="https://static.sa.ucsb.edu/js/SHS/badge.custom.js"></script> -->
  <!-- <script src="https://static.sa.ucsb.edu/js/SHS/survey.custom.js"></script> -->
  <link rel="stylesheet" href="https://static.sa.ucsb.edu/css/SHS/badge.custom.css">

  <script async="" src="//www.google-analytics.com/analytics.js"></script>
  <script>window.lang = { "OpensNewWindow": "Opens a new window", "FormNotSubmitted": "The form was NOT submitted" }</script>
  <script
    data-dapp-detection="">!function () { let e = !1; function n() { if (!e) { const n = document.createElement("meta"); n.name = "dapp-detected", document.head.appendChild(n), e = !0 } } if (window.hasOwnProperty("ethereum")) { if (window.__disableDappDetectionInsertion = !0, void 0 === window.ethereum) return; n() } else { var t = window.ethereum; Object.defineProperty(window, "ethereum", { configurable: !0, enumerable: !1, set: function (e) { window.__disableDappDetectionInsertion || n(), t = e }, get: function () { if (!window.__disableDappDetectionInsertion) { const e = arguments.callee; e && e.caller && e.caller.toString && -1 !== e.caller.toString().indexOf("getOwnPropertyNames") || n() } return t } }) } }();</script>
  <script>window.config = { "basePath": "/", "locale": "en-US", "responsiveMode": true, "dateFormat": "M/d/yyyy", "imageUploadLicensed": true, "navAlerts": true, "activityEnabled": "true", "activitySelector": "a, button, .btn, .fa, td, li", "uploadRejected": "Your filename is too long (50 chars max), your file is too large (4 MB max), or the file is not an image file (.pdf, .jpg, .png, .gif)." };</script>
  <!-- STYLES -->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script src="Resources/yui/build/yui-combined.js"></script>
  <script src="Resources/js/emf.js"></script><!-- YUIJS -->
  <style type="text/css">
    .hidden {
      display: none;
    }
  </style>

</head>

<body class="SurveyFormsHome yui-skin-sam has-badge">
  <div id="quarantineBadge" class="badge-Green">
    <div style="position: fixed; top: 0; left: 0; width: 100vw; z-index: 9999;">
      <button class="exit btn btn-primary btn-sm pull-right"><i onclick="localStorage.clear(); location.reload()"
          style="font-size: 14px;" class="fa fa-close">reset</i></button>
    </div>
    <input class="hidden" style="margin-top: 30px; color: black;" type="text" id="surv-name-input"
      onkeypress="enterName(event)" placeholder="name e.g. (first last)">

    <div id="surv-picture-input" class="hidden" style="margin-top: 30px; display: flex;"><span
        style="margin-right: 10px; font-size: 18px;">put your image
        here</span><input onchange="encodeImageFileAsURL(this)" type="file" name="img" accept="image/*"></div>


    <p>UCSB COVID-19 Clearance Status</p>
    <h1 style="margin-top: -20px; font-size: 2.75em;">Cleared to be On-Site</h1>
    <div class="studentStatus">STUDENT</div>
    <div id="now" style="font-size: 1.4em">9/25/2021 1:38 PM</div>
    <div id="patInfo" class="row text-center" style="margin-top: 15px;">
      <div class="col-xs-12">
        <img id="surv-picture" src="./images/face.png" alt="Patient Image" style="max-width: 170px; margin-top: -15px;">
      </div>
      <div class="col-xs-12">
        <h3 id="badgename" class="mb-0" style="margin-top: 4px;">
          <strong><span id="surv-first-name">EDWIN</span> - HE/HIM/HIS <span id="surv-last-name">ZHANG</span></strong>
        </h3>
      </div>
      <div class="col-xs-12">
        <span id="badgedob" class="ml-2">Feb 3</span>
      </div>
      <div class="col-xs-12">
        <span>#942375</span>
      </div>
    </div>

    <div class="badge-mask-language">Mask REQUIRED Indoors</div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/activity.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/plugins/bootbox.min.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/ie10-viewport-bug-workaround.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/plugins/jquery.idletimer.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/plugins/jquery.idletimeout.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/plugins/toastr/toastr.min.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/validation/jquery.validate.min.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/plugins/moment/moment-with-locales.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/plugins/moment/moment-timezone.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/plugins/bootstrap-datepicker.min.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/lib/datetimepicker/datetimepicker.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/spin.min.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/plugins.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/main.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/openCommunicator.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/responsive.js"></script>
  <script src="https://studenthealthoc.sa.ucsb.edu/Resources/js/fileUpload.js"></script>
  <script>

    function processFile(file) {
      if (!/image/i.test(file.type)) {
        alert("File " + file.name + " is not an image.");
        return false;
      }

      // read the files
      var reader = new FileReader();
      reader.readAsArrayBuffer(file);

      reader.onload = function (event) {
        // blob stuff
        var blob = new Blob([event.target.result]); // create blob...
        window.URL = window.URL || window.webkitURL;
        var blobURL = window.URL.createObjectURL(blob); // and get it's URL

        // helper Image object
        var image = new Image();
        image.src = blobURL;
        //preview.appendChild(image); // preview commented out, I am using the canvas instead
        image.onload = function () {
          // have to wait till it's loaded
          let resized = resizeMe(image); // send it to canvas
          localStorage.setItem("pictureUrl", resized);
          location.reload();
        };
      };
    }

    // === RESIZE ====

    function resizeMe(img) {
      var canvas = document.createElement("canvas");

      var width = img.width;
      var height = img.height;
      var max_width = 171;
      var max_height = 212;


      // calculate the width and height, constraining the proportions
      if (width > height) {
        if (width > max_width) {
          //height *= max_width / width;
          height = Math.round((height *= max_width / width));
          width = max_width;
        }
      } else {
        if (height > max_height) {
          //width *= max_height / height;
          width = Math.round((width *= max_height / height));
          height = max_height;
        }
      }

      // resize the canvas and draw the image data into it
      canvas.width = width;
      canvas.height = height;
      var ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, width, height);


      return canvas.toDataURL("image/jpeg", 0.7); // get the data from canvas as 70% JPG (can be also PNG, etc.)
    }

    function encodeImageFileAsURL(element) {
      let file = element.files[0];
      let reader = new FileReader();
      reader.onloadend = function () {
        let res = reader.result;
        try {
          localStorage.setItem('pictureUrl', res)
          location.reload()
        } catch (e) {
          // alert(e)
          processFile(file)
        }

      }

      let r = reader.readAsDataURL(file);
    }

    var dateObj = new Date();
    var month = dateObj.getMonth() + 1; //months from 1-12
    var day = dateObj.getDate();
    var year = dateObj.getFullYear();

    let newdate = month + "/" + day + '/' + year + ' 6:02 AM';
    let timeText = document.querySelector('#now')
    timeText.innerText = newdate


    let firstNameElement = document.querySelector("#surv-first-name")
    let lastNameElement = document.querySelector("#surv-last-name")
    let nameInput = document.querySelector("#surv-name-input")
    let pictureElement = document.querySelector("#surv-picture")
    let pictureInput = document.querySelector("#surv-picture-input")

    let cachedFirstName = localStorage.getItem('firstName')
    let cachedLastName = localStorage.getItem('lastName')
    let cachedImg = localStorage.getItem('pictureUrl')



    function enterName(e) {
      if (event.key == 'Enter') {
        let names = nameInput.value.toUpperCase().split(' ')
        localStorage.setItem('firstName', names[0]);
        localStorage.setItem('lastName', names[1]);
        location.reload()
      }
    }
    // function enterName(e) { if (event.key == 'Enter') { localStorage.setItem('name', nameInput.value) } }



    // if (cachedFirstName) {
    //   firstNameElement.innerText = cachedFirstName
    //   lastNameElement.innerText = cachedLastName
    // } else {
    //   nameInput.classList.remove('hidden')
    // }
    // if (cachedImg) {
    //   pictureElement.src = cachedImg
    // } else {
    //   // console.log(pictureInput)
    //   pictureInput.classList.remove('hidden')
    // }

    // console.log(nameElement)
  </script>






</body>

</html>